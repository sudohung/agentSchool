# Agents 模块详细分析

## 1. 模块概述

Agents 模块是 Agent School 项目的核心，包含了多种专业 AI 代理的实现。每个代理都有明确的职责分工和专门的技能集，通过 YAML 格式的配置文件定义代理的能力和行为。

## 2. 代理类型分析

### 2.1 文档专家代理 (doc-agent)
**职责**: 专业的技术文档工程师，专注于各类文档的撰写和处理。

**核心能力**:
- 使用 Mermaid 绘制各类可视化图表（强制使用文本绘图语言）
- 禁止输出 ASCII 伪图表或长串文本描述的"流程图"
- 支持多种文档格式：Markdown、Word、PDF、PPT

**文档模板**:
- **业务技术文档**: 采用标准化六模块结构
  - 1. 业务概述（业务背景、目标、核心流程、术语表）
  - 2. 系统架构（系统定位、架构图、模块说明、依赖关系）
  - 3. 数据设计（ER图、表结构、数据字典、数据流转）
  - 4. 接口文档（内外部接口、消息定义、错误码）
  - 5. 部署运维（部署架构、配置说明、监控告警）
  - 6. 变更记录（版本历史、重大变更说明）

**图表规范**:
- 必须使用 Mermaid 语法
- 支持流程图、时序图、类图、ER图、状态图、甘特图、饼图、架构图
- 提供完整的模板和示例

**协作规则**:
- 与 java-analyst-agent 协作进行系统分析
- 与 architect-agent 协作进行架构评估
- 与 code-reviewer 协作进行代码审查
- 与 data-agent 协作进行数据分析

### 2.2 Java 系统分析专家代理 (java-analyst-agent)
**职责**: 拥有20年经验的资深 Java 架构师，专注于复杂系统的分析和文档化。

**核心能力**:
- **基础能力**: 项目扫描、依赖分析、配置解读、代码统计
- **专业能力**: 架构逆向、业务追踪、状态机分析、数据建模、热点识别、技术债评估

**分析流程**:
1. 项目全貌扫描（技术栈识别、代码规模统计、Git 历史概览）
2. 技术架构解析（依赖分析、配置解读、入口点识别）
3. 模块结构梳理（包结构分析、核心类识别、接口契约分析）
4. 核心业务追踪（业务入口定位、调用链追踪、数据流分析）
5. 数据层理解（实体分析、表结构梳理、SQL 分析）
6. 文档输出（整合所有分析结果，生成结构化文档）

**常用命令**:
- Git 分析：`git shortlog -sn --all`, `git log --name-only`
- 代码分析：`find . -name "*.java"`, `grep -rn "@RestController"`

**新人友好原则**:
- 由浅入深：先介绍"是什么"，再解释"为什么"
- 图文并茂：使用可视化图表辅助理解
- 实例驱动：提供具体代码示例
- 快速定位：提供代码导航索引
- FAQ 覆盖：收集常见问题和调试技巧

### 2.3 其他专业代理
- **code-reviewer**: 代码质量评审，遵循最佳实践
- **architect-agent**: 架构设计评估，模式识别
- **debug-agent**: 问题定位和错误分析
- **refactor-agent**: 代码优化和技术债务处理
- **skill-creator-agent**: 技能定义和能力扩展
- **test-agent**: 测试用例生成和覆盖率分析
- **data-agent**: 数据处理和分析
- **devops-agent**: 运维和部署自动化
- **frontend-agent**: 前端开发和UI设计

## 3. 验证器子系统 (Validators)

### 3.1 系统架构
验证器子系统采用了多代理协作的创新架构，包含1个协调器代理和9个专家代理，总共10个代理协同工作。

### 3.2 工作流程
**Phase 1: Initialization (Coordinator)**
1. 用户提供文档路径
2. 协调器创建会话目录
3. 协调器分析文档结构

**Phase 2: Task Distribution (Coordinator)**
4. 从文档中提取验证项
5. 生成最多10个任务文件
6. 每个任务文件包含具体的检查清单

**Phase 3: Parallel Execution (Expert Agents)**
7. 协调器并行调用专家代理
8. 每个专家代理执行验证并生成结果
9. 结果文件包含置信度评分和详细信息

**Phase 4: Aggregation (Coordinator)**
10. 协调器收集所有结果
11. 解决冲突并生成最终报告
12. 归档会话到历史目录

### 3.3 验证维度
- **Entity Validator**: 实体模型 vs 代码类
- **ER Diagram Validator**: ER图 vs JPA实体  
- **API Validator**: API接口 vs Controller
- **Method Validator**: 方法签名 vs Service方法
- **State Validator**: 状态机 vs 代码逻辑
- **Flow Validator**: 业务流程 vs 实现
- **DataFlow Validator**: 数据流 vs 转换逻辑
- **Reference Validator**: 文件引用 vs 实际路径
- **Structure Validator**: 文档结构 vs 完整性

### 3.4 关键特性
- **专家优先级冲突解决**: 领域专家意见优先
- **最大容错性**: 单个代理失败不影响整体
- **并行执行**: 最多10个代理同时运行
- **置信度评分**: 客观的0.0-1.0评分
- **可操作见解**: 具体的修复建议和位置引用

## 4. 性能与维护

### 4.1 性能指标
- 大型文档典型执行时间：10-16分钟
- 平均验证通过率：91%
- 平均置信度：0.87

### 4.2 最佳实践
- 将验证报告提交到版本控制
- 在重大代码重构后进行验证
- 优先处理高优先级问题
- 定期审查低置信度项目

### 4.3 扩展性
- 易于添加新的验证维度
- 支持自定义验证规则
- 可配置的置信度阈值
- 可定制的报告格式
